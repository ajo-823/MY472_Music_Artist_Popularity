---
title: "Assignment Template"
class: "MY 472"
date: "AT 2023"
output: html_document
---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(echo = FALSE)
```
## Edited Assignment Instructions for Part I: Data Science Project (70 Marks)

In Part 1 of your final assignment you will complete an independent data science project summarised in a written report. Your final written report should be no longer than 750 words (excluding code), and should consist of four sections (see below).

Offer an answer to the research question using data from at least the required data sources, however you are encouraged to think more broadly and use data from other sources if you would like. Note that you do not have to use all the data from the required data sources – the requirement is only that you must use some data from these sources. It may also be wise to limit the amount of data you use (e.g. by randomly sampling, or by limiting the geographic or temporal coverage of your project) to make things manageable.

* Completing the core data science task: answering the research question with data from the required data sources.
* The creativity and depth with which you answer the question (e.g. using additional data beyond the required data, creative analyses, careful discussion of issues and difficulties in interpretation, etc.).
* The quality of presentation in your final document (e.g. well-presented tables, compelling visualisations, strong interpretations and explanations, etc.).
* The quality of data science practice exhibited (e.g. replicability, well-written and efficient code, effective annotation, principled web-scraping, etc.).

## Introduction
*A brief introduction to the research question and your approach to answering it. You do not need to cite any literature or write a literature review.*

Research question:
“Rolling Stone Magazine ranked their 100 greatest musical artists of all time. At the end of 2023, how has their music endured? Are there any features or characteristics that seem to explain enduring engagement?

## Data
*A discussion of the data sources you used, how you accessed them, how you processed the data, the structure of your final analysis dataset(s), and so on.*

Required data sources:
Rolling Stone’s 100 Greatest Artists, 2010
Spotify Web API

```{r}

# IMPORTS ----------------------------------------------------------------------
library(tidyverse)
library(RSelenium)
library(netstat)
library(spotifyr)

# FUNCTIONS --------------------------------------------------------------------

# FUNCTION to get list of elements given a selector
# Assumes driver is already set up and navigated to URL
get_RStop100_element <- function(selector) {
  elements <- driver$findElements(using = "xpath", value = selector)
  selected_items <- sapply(elements, function(element) element$getElementText())
  return(unlist(selected_items))
}
```

```{r}
# Load data from Rolling Stone's 100 Greatest Artists, 2010

# XPATH selectors
ranking_selector <- '//*[@class="c-gallery-vertical-album__number"]'
artist_selector <- '//*[@class="c-gallery-vertical-album__title"]'
essay_selector <- '//*[@class="c-gallery-vertical-album__description"]'

# Setup driver and Navigate to URL (first half of top 100 list)
rD <- rsDriver(browser = c("firefox"), port = free_port(random = TRUE), chromever = NULL) 
driver <- rD$client
url <- 'https://www.rollingstone.com/music/music-lists/100-greatest-artists-147446/'
driver$navigate(url)

# Get information for first 50 artists (#100-51)
ranking_first <- get_RStop100_element(ranking_selector)
artists_first <- get_RStop100_element(artist_selector)
essays_first <- get_RStop100_element(essay_selector)

# Load page with second half of top 100 list
to_scroll <- driver$findElement(using = "xpath", value = '/html/body/div[5]/main/div[2]/div[1]/div/article/div[3]/div[2]/div[2]/a')
driver$executeScript("arguments[0].scrollIntoView(true);", list(to_scroll))
below_50 <- driver$findElement(using = 'xpath', value = '/html/body/div[5]/header/div[2]/div/div/div/div/aside/div/div[2]/a[6]')
below_50$clickElement()
 
# Get information for second 50 artists (#50-1)
ranking_second <- get_RStop100_element(ranking_selector)
artists_second <- get_RStop100_element(artist_selector)
essays_second <- get_RStop100_element(essay_selector)

# Combine info for first and second 50 (for total of 100)
ranking <- c(ranking_first, ranking_second)
artists <- c(artists_first, artists_second)
essays <- c(essays_first, essays_second)

# Create table with variables for Ranking, Artist name, and Essay (description of legacy)
top100_table <- data.frame(Rank = ranking, Artist = artists, Essay = essays)

```

```{r}
# Access Spotify API
readRenviron("../spotify_api.env")
Sys.setenv(SPOTIFY_CLIENT_ID = Sys.getenv("CLIENT_ID"),
           SPOTIFY_CLIENT_SECRET = Sys.getenv("CLIENT_SECRET"))

# Function to get artists info given their name
get_artist_info <- function(name) {
  
  # Search for artist to get Spotify ID
  artist_search_results <- search_spotify(name,'artist')
  artist_id <- artist_search_results$id[[1]]
  
  # Get artist info and return
  artist_info <- get_artist(artist_id)
  return(artist_info)
}

# Function to return artist name, popularity, genres, number of genres
get_popularity_vars <- function(artist_info) {
  
  # Get values for each popularity variable
  spotify_id <- artist_info$id
  name <- artist_info$name
  popularity <- artist_info$popularity
  genres <- paste(artist_info$genres, collapse = ", ")
  num_genres <- length(artist_info$genres)
  
  # Format and return results
  popularity_vars <- list(spotify_id,name,popularity,genres,num_genres)
  return(popularity_vars)
}

top_artists <- data.frame()
for (artist in top100_table$Artist) {
  pop_vars <- get_popularity_vars(get_artist_info(artist))
  top_artists <- rbind(top_artists,pop_vars)
}
colnames(top_artists) <- c("ID","Artist","Popularity","Genres","Num_Genres")

top_artists

```

## Analysis
*A presentation of your analysis, including figures/graphs/maps, and a discussion of your findings. In general, we do not expect you to conduct or interpret any formal statistical tests, though you may do this if you wish. Remember that your discussion should translate your specific analysis and results back to the level of the research question.*

```{r}
# Statistical Analysis

```

```{r}
# Data Visualization

```

## Appendix
*As in the previous assignments, all code that you do not wish to directly include in your report should be included in a code appendix at the end of the document.*

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE} 
```
